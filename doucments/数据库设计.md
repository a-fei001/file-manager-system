-- 1. 用户表
CREATE TABLE IF NOT EXISTS sys_user (
    id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,          -- 用户名唯一
    password VARCHAR(100) NOT NULL,                -- 存储加密后的密码
    role INT NOT NULL DEFAULT 0,                   -- 0:普通用户, 1:管理员
    join_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 入职时间
    description VARCHAR(100),                      -- 部门职称信息
    admin_id BIGINT,                               -- 操作的管理员ID
    admin_name VARCHAR(50)                         -- 操作的管理员名称
);

-- 2. 文档表
CREATE TABLE IF NOT EXISTS sys_document (
    id BIGSERIAL PRIMARY KEY,
    file_name VARCHAR(255) NOT NULL UNIQUE,        -- 文档名称唯一
    file_type VARCHAR(20),                         -- 文档类型 (pdf, docx, etc.)
    bucket_name VARCHAR(100) NOT NULL,             -- MinIO 桶名
    object_key VARCHAR(500) NOT NULL,              -- MinIO 对象键
    admin_id BIGINT NOT NULL,                      -- 存储的管理员ID
    admin_name VARCHAR(50),                        -- 存储的管理员名称
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- 存储时间
);

-- 3. 文档下载记录表
CREATE TABLE IF NOT EXISTS sys_download_log (
    id BIGSERIAL PRIMARY KEY,
    doc_id BIGINT NOT NULL,                        -- 文档ID
    doc_name VARCHAR(255) NOT NULL,                -- 文档名称
    user_id BIGINT NOT NULL,                       -- 下载用户ID
    username VARCHAR(50) NOT NULL,                 -- 下载用户名称
    download_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- 下载记录时间
);


-- 插入用户数据 (1个超级管理员，1个普通管理员，3个普通用户)
INSERT INTO sys_user (username, password, role, description, admin_id, admin_name) VALUES
('admin', '123456', 1, '系统管理部-架构师', 0, 'SYSTEM'),
('manager_lee', '123456', 1, '人事部-主管', 1, 'admin'),
('user_zhang', '123456', 0, '技术部-后端开发', 1, 'admin'),
('user_wang', '123456', 0, '市场部-专员', 2, 'manager_lee'),
('user_zhao', '123456', 0, '财务部-会计', 1, 'admin');

-- 插入文档数据 (模拟存储在 MinIO 的不同格式文件)
INSERT INTO sys_document (file_name, file_type, bucket_name, object_key, admin_id, admin_name) VALUES
('2025年度计划.pdf', 'pdf', 'company-files', '2025/plan_001.pdf', 1, 'admin'),
('员工手册.docx', 'docx', 'public-docs', 'manual/v1.docx', 1, 'admin'),
('第三季度财务报表.xlsx', 'xlsx', 'finance', '2025/q3_report.xlsx', 1, 'admin'),
('项目启动PPT.pptx', 'pptx', 'project', 'slides/kickoff.pptx', 2, 'manager_lee'),
('系统架构图.png', 'png', 'tech-docs', 'arch/v2.png', 1, 'admin');

-- 插入下载记录数据
INSERT INTO sys_download_log (doc_id, doc_name, user_id, username) VALUES
(1, '2025年度计划.pdf', 3, 'user_zhang'),
(1, '2025年度计划.pdf', 4, 'user_wang'),
(2, '员工手册.docx', 5, 'user_zhao'),
(3, '第三季度财务报表.xlsx', 3, 'user_zhang'),
(5, '系统架构图.png', 3, 'user_zhang');